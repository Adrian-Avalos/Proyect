<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icono.ico">
  <link rel="icon" type="image/x-icon" href="icono.ico">
  <title>Calculadora Nutricional Completa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-light">

  <div class="container mt-5 mb-5" id="contenido-pdf">
    <div class="d-flex gap-2 mb-4">
      <a href="menu.html" class="btn btn-secondary flex-fill">üîô Volver al inicio</a>
      <button onclick="generarPDF()" id="btn-pdf" class="btn btn-danger flex-fill">üìÑ Descargar PDF</button>
    </div>

    <h2 class="text-center mb-4">üçΩÔ∏è Calculadora Nutricional Completa</h2>

    <div class="mb-3 text-end">
      <strong>Fecha:</strong> <span id="fechaActual"></span>
    </div>

    <div class="mb-3">
      <label for="nombreUsuario" class="form-label">Nombre del paciente o usuario:</label>
      <input type="text" id="nombreUsuario" class="form-control" placeholder="Ej: Juan P√©rez" />
    </div>

    <!-- Tabla de alimentos -->
    <div class="table-responsive mb-3">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Alimento</th>
            <th>Cantidad</th>
            <th>Calor√≠as</th>
            <th>HC (g)</th>
            <th>Prot. (g)</th>
            <th>Grasa (g)</th>
            <th>Na (mg)</th>
            <th>K (mg)</th>
            <th>P (mg)</th>
            <th>Ca (mg)</th>
            <th>Fe (mg)</th>
            <th>Colest (mg)</th>
            <th>Purinas (mg)</th>
            <th>Fibra (g)</th>
            <th>Agua (g)</th>
            <th>A.F√≥lic (¬µg)</th>
          </tr>
        </thead>
        <tbody id="tabla-alimentos"></tbody>
      </table>
    </div>

    <!-- Totales -->
    <div id="totales" class="text-center fw-bold fs-5 mb-4">
      Totales: 0 cal | 0g HC | 0g Prot | 0g Grasas | 0mg Na | 0mg K | 0mg P | 0mg Ca | 0mg Fe | 0mg Colest | 0mg Purinas | 0g Fibra | 0g Agua | 0¬µg A.F√≥lic
    </div>

    <!-- Gr√°fico Circular -->
    <div class="text-center">
      <canvas id="graficoCircular" width="300" height="300"></canvas>
    </div>

    <div class="mt-4">
      <label for="observaciones" class="form-label">üìù Observaciones:</label>
      <textarea class="form-control" id="observaciones" rows="3" placeholder="Escribir aqu√≠..."></textarea>
    </div>
  </div>

  <script src="datos/datos.js"></script>

  <script>
    let alimentosSeleccionados = [];
    let grafico = null;

    document.getElementById("fechaActual").textContent = new Date().toLocaleDateString();

    function generarPDF() {
      const element = document.getElementById('contenido-pdf');
      html2pdf().set({
        margin: 0.5,
        filename: `reporte-${document.getElementById("nombreUsuario").value || 'nutricional'}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      }).from(element).save();
    }

    function actualizarGrafico(totales) {
      const ctx = document.getElementById('graficoCircular').getContext('2d');
      const data = [totales.hc, totales.proteinas, totales.grasas];
      const labels = ['Carbohidratos', 'Prote√≠nas', 'Grasas'];

      if (grafico) grafico.destroy();
      grafico = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{ data, backgroundColor: ['#ffc107', '#198754', '#dc3545'] }]
        },
        options: {
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }
  </script>

</body>
</html>
